steps:
# 1️⃣ Create Instance Template
- name: gcr.io/cloud-builders/gcloud
  args:
    - compute
    - instance-templates
    - create
    - ipv4-v6-template-fixed
    - --machine-type=e2-micro
    - --image-family=debian-12
    - --image-project=debian-cloud
    - --subnet=ipv4-v6-subnet
    - --region=asia-south1
    - --stack-type=IPV4_IPV6
    - --network-tier=PREMIUM
    - --tags=allow-http,allow-https,allow-ssh,ipv4-v6
    - --metadata-from-file=startup-script=startup.sh

# 2️⃣ Create Managed Instance Group
- name: gcr.io/cloud-builders/gcloud
  args:
    - compute
    - instance-groups
    - managed
    - create
    - ipv4-v6-mig
    - --base-instance-name=ipv4-v6
    - --size=1
    - --template=ipv4-v6-template-fixed
    - --region=asia-south1

# 3️⃣ Enable Autohealing (Optional)
- name: gcr.io/cloud-builders/gcloud
  args:
    - compute
    - instance-groups
    - managed
    - set-autohealing
    - ipv4-v6-mig
    - --region=asia-south1
    - --health-check=default

options:
  logging: CLOUD_LOGGING_ONLY
